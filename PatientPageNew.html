<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1, width=device-width" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="./global.css" />
  <link rel="stylesheet" href="./PatientPageNew.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap" />
</head>
<body>
  <div class="patient-page-new">
    <div class="cover-blue-background">
      <div class="cover-blue-background-child"></div>
    </div>
    <header class="navbar">
      <div class="white-navbar-background1"></div>
      <div class="pages-container">
        <div class="nav-link">
          <div class="patient-page">Patient Page</div>
          <div class="home-page" id="homePageText">Home Page</div>
        </div>
      </div>
    </header>
    <div class="logo-medimatch-box-3">
      <img class="logo-box-icon1" alt="" src="img & icon/HealthLogo.svg" />
      <b class="medimatch3">
        <span>Medi</span>
        <span class="match2">Match</span>
      </b>
    </div>
    <div class="header-blue-background">
      <div class="header-text1">
        The health and well-being of our patients and their health care team
        will always be our priority.
      </div>
    </div>
    <div class="blue-line-navbar1"></div>
    <div class="white-background"></div>
    <button class="download-button" id="downloadButton" onclick="downloadAsPDF()">
      <div class="download-button-2">
        <div class="download-button-frame">
          <div class="download-button-text">Download Patient Profile</div>
        </div>
      </div>
    </button>
    <img class="blue-line-icon" alt="" src="./public/blue-line.svg" />
    <div class="full-content-box">
      <div class="lifestyle-box1">
        <textarea
          class="lifestyle-plan-output"
          placeholder="LifeStyle Plan recommendation"
          id="lifestylePlanOutput"
        ></textarea>
      </div>
      <div class="recommendation-box">
        <div class="dosage-new-recommendation-box">
          <div class="recommendation-box1">
            <div class="last-recommendation-box"></div>
          </div>
          <div class="new-dosage-box">
            <div
              class="dosage-update-output"
              placeholder="Dosage Update"
              id="dosageUpdateOutput"
            ></div>
            <div class="dosage">Dosage</div>
          </div>
        </div>
        <div class="medication-new-recommendation">
          <div class="new-medication-box">
            <div
              class="medication-update-output"
              placeholder="Medication Update"
              id="medicationUpdateOutput"
            ></div>
            <div class="medication">Medication</div>
          </div>
        </div>
        <div class="medication-last-frame">
          <div class="medication-last-box">
            <div
              class="latest-medication-output"
              placeholder="Latest Medication"
              id="latestMedicationOutput"
            ></div>
            <div class="medication-last-text">Medication</div>
          </div>
        </div>
        <div class="dosage-last-frame">
          <div class="dosage-last-box">
            <div
              class="latest-medication-output"
              placeholder="Latest Dosage"
              id="latestDosageOutput"
            ></div>
            <div class="dosage-last-text">Dosage</div>
          </div>
        </div>
      </div>
      <div class="lifestyle-plan-text">Lifestyle Plan</div>
      <div class="patient-information-text">Patient Information</div>
      <div class="last-recommendation-if-container">
        <span>LAST RECOMMENDATION </span>
        <span class="if-exist">(IF EXIST)</span>
      </div>
      <div class="new-recommendation-if-container">
        <span>NEW RECOMMENDATION </span>
        <span class="if-exist">(IF THERE IS AN UPDATE)</span>
      </div>
      <div class="patient-information-box">
        <div class="height-weight-input-box">
          <div class="height-input">
            <div class="height-output" id="heightOutput"></div>
          </div>
          <div class="weight-input">
            <div class="height-output" id="weightOutput"></div>
          </div>
        </div>
        <div class="height-weight-box">
          <div class="height-text">Height</div>
          <div class="height-text">Weight</div>
        </div>
        <div class="age-sex-box">
          <div class="sex-box">
            <div class="age-input">
              <div class="age-output" id="ageOutput"></div>
            </div>
            <div class="age">Age</div>
            <div class="sex-output" id="sexOutput"></div>
            <div class="sex">Sex</div>
          </div>
        </div>
      </div>
    </div>
    <div class="tests-box">
      <div class="hba1c-text">HbA1c</div>
      <div class="fbs-text">FBS</div>
      <div class="rbs-text">RBS</div>
      <div class="bp-text">BP</div>
      <div class="fbs-output" id="fbsOutput"></div>
      <div class="rbs-output" id="rbsOutput"></div>
      <div class="bp-output" id="bpOutput"></div>
      <div class="hba1c-output" id="hba1cOutput"></div>
    </div>
    <div class="diabetes-hypertension-box">
      <div class="diabetes-mellitus">Diabetes Mellitus</div>
      <div class="hypertension">Hypertension</div>
      <div class="hypertension-output" id="hypertensionOutput"></div>
      <div class="diabetes-output" id="diabetesOutput"></div>
    </div>
    <div class="patient-box">
      <div class="patient-id-6189-container">
        <span class="patient-id">Patient ID: </span>
        <span class="span" id="patientIdOutput"></span>
      </div>
      <div class="patient-profile">Patient Profile</div>
    </div>
  </div>

  <script>
    var homePageText = document.getElementById("homePageText");
    if (homePageText) {
      homePageText.addEventListener("click", function (e) {
        window.location.href = "./index.html";
      });
    }
    
    function downloadAsPDF() {
      // Create a new jsPDF instance
      var pdf = new jsPDF();

      // Get the HTML content of the entire page
      var htmlContent = document.documentElement.innerHTML;

      // Set up options for jsPDF
      var options = {
        // Specify the width of the PDF document
        width: pdf.internal.pageSize.getWidth(),
        // Specify the height of the PDF document
        height: pdf.internal.pageSize.getHeight(),
        // Set the "useCORS" option to true to enable CORS support
        useCORS: true
      };

      // Use the fromHTML method to add HTML content to the PDF
      pdf.fromHTML(htmlContent, 15, 15, options, function () {
        // Save the PDF with the specified filename
        pdf.save("patient_profile.pdf");
      });
    }

    fetch("http://localhost:8000/patient_data")
      .then(response => response.json())
      .then(data => {
      console.log(data)
        document.getElementById("heightOutput").innerText = data.height;
        document.getElementById("weightOutput").innerText = data.weight;
        document.getElementById("ageOutput").innerText = data.age;
        document.getElementById("sexOutput").innerText = data.sex;
        document.getElementById("fbsOutput").innerText = data.fbs;
        document.getElementById("rbsOutput").innerText = data.rbs;
        document.getElementById("bpOutput").innerText = data.bp;
        document.getElementById("hba1cOutput").innerText = data.hba1c;
        document.getElementById("hypertensionOutput").innerText = data.hypertension ? "True" : "False";
        document.getElementById("diabetesOutput").innerText = data.diabetes ? "True" : "False";
        document.getElementById("patientIdOutput").innerText = data.patient_id;
        document.getElementById("lifestylePlanOutput").innerText = data.recommendation;
        document.getElementById("latestDosageOutput").innerText = data.Latest_Dosage;
        document.getElementById("latestMedicationOutput").innerText = data.Latest_Medication;        
      })
      .catch(error => console.error("Error fetching data:", error));
  </script>
</body>
</html>
